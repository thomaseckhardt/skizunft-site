---
import clsx from 'clsx'

const {
  iconStart,
  iconEnd,
  required = true,
  placeholder,
  label,
  name,
  id,
  description,
  error,
  disabled = false,
  xModel,
  type = 'text',
  xError,
  xErrorMessage,
} = Astro.props

const finalId = id || label ? name : undefined

const isNumber = type === 'number'
---

<div class="text-sm leading-6">
  {
    label && (
      <div class="flex justify-between">
        <label for={finalId} class="block text-sm font-medium leading-6 text-gray-900">
          {label}
        </label>
        {!required && (
          <span class="text-sm leading-6 text-gray-500" id="email-optional">
            Optional
          </span>
        )}
      </div>
    )
  }
  <div class={clsx('relative rounded-md shadow-sm', label && 'mt-1')}>
    {
      iconStart && (
        <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
          <svg class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
            <path d="M3 4a2 2 0 00-2 2v1.161l8.441 4.221a1.25 1.25 0 001.118 0L19 7.162V6a2 2 0 00-2-2H3z" />
            <path d="M19 8.839l-7.77 3.885a2.75 2.75 0 01-2.46 0L1 8.839V14a2 2 0 002 2h14a2 2 0 002-2V8.839z" />
          </svg>
        </div>
      )
    }
    <input
      type={type}
      id={finalId}
      class={clsx(
        'block w-full rounded-md border-0 py-1.5 ',
        'sm:text-sm sm:leading-6',
        'ring-1 ring-inset focus:ring-inset focus:ring-2',
        'disabled:cursor-not-allowed disabled:bg-gray-50 disabled:text-gray-500 disabled:ring-gray-200',
        error
          ? 'text-red-900 placeholder:text-red-300 ring-red-300 focus:ring-red-500'
          : 'text-gray-900 placeholder:text-gray-400 ring-gray-300 focus:ring-sky-500',
        iconStart && 'pl-10',
        (iconEnd || error) && 'pr-10',
      )}
      placeholder={placeholder}
      {...isNumber ? { 'x-model.number': xModel } : { 'x-model': xModel }}
    />
    {
      iconEnd && !error && (
        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3">
          <svg class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
            <path
              fill-rule="evenodd"
              d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM8.94 6.94a.75.75 0 11-1.061-1.061 3 3 0 112.871 5.026v.345a.75.75 0 01-1.5 0v-.5c0-.72.57-1.172 1.081-1.287A1.5 1.5 0 108.94 6.94zM10 15a1 1 0 100-2 1 1 0 000 2z"
              clip-rule="evenodd"
            />
          </svg>
        </div>
      )
    }
    {
      error && (
        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3">
          <svg class="h-5 w-5 text-red-500" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
            <path
              fill-rule="evenodd"
              d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z"
              clip-rule="evenodd"
            />
          </svg>
        </div>
      )
    }
    {
      xError && (
        <div x-show={xError} class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3">
          <svg class="h-5 w-5 text-red-500" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
            <path
              fill-rule="evenodd"
              d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z"
              clip-rule="evenodd"
            />
          </svg>
        </div>
      )
    }
  </div>
  {
    error && (
      <div class="mt-1 text-sm text-red-600">
        <slot name="error">
          <p>{error}</p>
        </slot>
      </div>
    )
  }
  {
    xErrorMessage && (
      <div x-show={xError} class="mt-1 text-sm text-red-600">
        {xErrorMessage}
      </div>
    )
  }
  {
    description && (
      <div class="mt-1 text-sm text-gray-500">
        <slot name="description">
          <p>{description}</p>
        </slot>
      </div>
    )
  }
</div>
